<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Transactions</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" 
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
</head>
<body>
  <div class="container my-4">
    <h1 class="mb-4">Transactions</h1>
    {% if filter_info %}
      <p class="text-muted"><small>{{ filter_info }}</small></p>
    {% endif %}
    <div class="mb-3">
      <button id="resetFilters" class="btn btn-secondary btn-sm">
        <i class="bi bi-arrow-clockwise me-1"></i>Reset Filters
      </button>
    </div>
    <table id="transactionsTable" class="table table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th><i class="bi bi-hash me-1"></i> ID</th>
            <th><i class="bi bi-bank me-1"></i> Bank</th>
            <th><i class="bi bi-calendar me-1"></i> Date</th>
            <th><i class="bi bi-person me-1"></i> Sender</th>
            <th>Reciver</th>
            <th><i class="bi bi-currency-euro me-1"></i> Value</th>
            <th>Currency</th>
            <th><i class="bi bi-card-text me-1"></i> Description</th>
            <th>Invoice</th>
            <th><i class="bi bi-file-earmark-text me-1"></i> File</th>
        </tr>
    </thead>
      <tfoot>
        <tr>
            <th>ID</th>
            <th>Bank</th>
            <th>Date</th>
            <th>Sender</th>
            <th>Reciver</th>
            <th>Value</th>
            <th>Currency</th>
            <th>Description</th>
            <th>Invoice</th>
            <th>File</th> 
        </tr>
      </tfoot>
      <tbody>
        {% for t in transactions %}
          <tr class="{% if t.amount is none %}table-warning{% endif %}">
            <td>{{ t.id }}</td>
            <td>{{ t.bank }}</td>
            <td>{{ t.date }}</td>
            <td>{{ t.sender }}</td>
            <td>{{ t.to }}</td>
            <td>
              {% if t.amount is not none %}
                {% if t.amount < 0 %}
                  <i class="bi bi-arrow-down-circle-fill text-danger me-1"></i>
                  <span class="text-danger">{{ t.amount }}</span>
                {% else %}
                  <i class="bi bi-arrow-up-circle-fill text-success me-1"></i>
                  <span class="text-success">{{ t.amount }}</span>
                {% endif %}
              {% else %}
                <span class="text-danger">No Value defined!</span>
              {% endif %}
            </td>
            <td>{{ t.currency }}</td>
            <td>{{ t.description }}</td>
            <td>{{ t.invoice }}</td>
            <td>
              <a href="{{ t.file_path }}">
                <i class="bi bi-file-earmark-text me-1"></i>
                {{ t.file_name }}
              </a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
  <script>
    $(document).ready(function() {
        // Add a text input to each footer cell
        $('#transactionsTable tfoot th').each(function () {
            var title = $(this).text();
            $(this).html('<input type="text" placeholder="Search ' + title + '" class="form-control form-control-sm" />');
        });
        var table = $('#transactionsTable').DataTable({
            "order": [[ 0, "desc" ]],
            "pageLength": 25,
            "lengthMenu": [[10, 25, 50, 100, 200, 500, 1000, 2000, 5000, -1], [10, 25, 50, 100, 200, 500, 1000, 2000, 5000, "All"]],
            initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    var uniqueData = column.data().unique().sort().toArray();
                    if(uniqueData.length <= 12) {
                        var select = $("<select class='form-select form-select-sm'><option value=''>All</option></select>")
                            .appendTo($(column.footer()).empty())
                            .on("change", function () {
                                var val = $.fn.dataTable.util.escapeRegex($(this).val());
                                column.search(val ? "^" + val + "$" : "", true, false).draw();
                            });
                        $.each(uniqueData, function (i, d) {
                            select.append("<option value='" + d + "'>" + d + "</option>");
                        });
                    } else {
                        $("input", column.footer()).on("keyup change clear", function () {
                            if (column.search() !== this.value) {
                                column.search(this.value).draw();
                            }
                        });
                    }
                });
            }
        });

        // Reset Filters button: clear all column searches and redraw table.
        $('#resetFilters').on('click', function () {
            table.columns().search('').draw();
            $('#transactionsTable tfoot input').val('');
            $('#transactionsTable tfoot select').val('');
        });
    });
  </script>
</body>
</html>
